            <div className="encode-rep-slider-wrap" ref={repSliderWrapRef}>
              <input
                id="encode-representation-axis"
                className="encode-rep-slider"
                type="range"
                min={0}
                max={REPRESENTATION_ORDER.length - 1}
                step={1}
                value={representationIndex}
                onChange={event => handleRepresentationSlider(Number(event.target.value))}
                aria-label="Representation axis slider"
              />
              {juicyActive && (
                <span
                  className="encode-rep-handle-visual"
                  style={{ left: sliderAlignedLeft }}
                  aria-hidden="true"
                />
              )}
              {juicyActive && isTransitioning && sliderDirection && (
                <span
                  className={`encode-rep-direction is-${sliderDirection}`}
                  style={{ left: sliderAlignedLeft }}
                  aria-hidden="true"
                >
                  <svg viewBox="0 0 40 24" className="encode-rep-direction-svg">
                    <path d="M4 12h23l-5.2-5.2 2.9-2.8L36 12l-11.3 8-2.9-2.8L27 12H4z" />
                  </svg>
                </span>
              )}
            </div>
          </div>
        </div>

        <div className="encode-fx-layer" aria-hidden="true">
          {juicyActive && chartFlashPulseId > 0 && (
            <span className="encode-chart-flash" key={`flash-${chartFlashPulseId}`} />
          )}
          {juicyActive && ripple && (
            <span
              className="encode-ripple"
              style={
                {
                  left: `${ripple.x}px`,
                  top: `${ripple.y}px`,
                  borderColor: ripple.color
                } as CSSProperties
              }
            />
          )}
          {particles.map(particle => (
            <span
              key={particle.id}
              className={`encode-particle is-${particle.variant}`}
              style={
                {
                  left: `${particle.x}px`,
                  top: `${particle.y}px`,
                  width: `${particle.size}px`,
                  height: `${particle.size}px`,
                  background: particle.color,
                  '--encode-dx': `${particle.dx}px`,
                  '--encode-dy': `${particle.dy}px`
                } as CSSProperties
              }
            />
          ))}
        </div>

        {juicyActive && (
          <>
            <div className={`encode-wheel-preview-vignette ${wheelPreviewActive ? 'on' : ''}`} />
            <div className={`encode-wheel-preview-dust ${wheelPreviewActive ? 'on' : ''}`} />
            <div className={`encode-projector-flash ${projectorFlashActive ? 'on' : ''}`} />
            <div className={`transition-vignette ${isTransitioning ? 'on' : ''}`} />
            <div className={`transition-swipe ${isTransitioning ? 'on' : ''}`} />
          </>
        )}
      </div>

      <aside className="encode-panel">
        <div className="encode-control-group">
          <label className="encode-control-label" htmlFor="encode-measure">
            Measure
          </label>
          <select
            id="encode-measure"
            className="encode-select"
            value={activeMeasure}
            disabled={measureLocked}
            onChange={event => handleMeasureChange(event.target.value as Measure)}
          >
            <option value="kg">kg</option>
            <option value="percent">percent</option>
          </select>
        </div>

        <div className="encode-control-group">
          <label className="encode-control-label" htmlFor="encode-focus">
            Focus Category
          </label>
          <select
            id="encode-focus"
            className="encode-select"
            value={focusCategory}
            onChange={event =>
              handleFocusCategoryChange(event.target.value as FocusCategory, event.currentTarget)
            }
          >
            <option value="All">All</option>
            {MEAT_CATEGORIES.map(category => (
              <option key={category.key} value={category.key}>
                {category.label}
              </option>
            ))}
          </select>
        </div>

        <div className="encode-color-editor">
          <div className="encode-control-label">Color Encoding</div>
          <div className="encode-color-hint">Click swatches to edit colors</div>
          <div className="encode-color-list">
            {MEAT_CATEGORIES.map(category => (
              <div key={`color-${category.key}`} className="encode-color-row">
                <button
                  type="button"
                  className="encode-color-swatch-button"
                  style={{ backgroundColor: categoryColors[category.key] }}
                  aria-label={`Edit ${category.label} color`}
                  onClick={event => handleColorSwatchClick(event, category.key)}
                />
                <span className="encode-color-name">{category.label}</span>
                <input
                  ref={element => {
                    colorInputRefs.current[category.key] = element
                  }}
                  className="encode-color-input"
                  type="color"
                  value={categoryColors[category.key]}
                  onFocus={event => handleColorInputFocus(event, category.key)}
                  onChange={event =>
                    handleCategoryColorChange(category.key, event.target.value, event.currentTarget)
                  }
                  aria-label={`${category.label} color`}
                />
              </div>
            ))}
          </div>
        </div>
      </aside>

      {juicyActive && (
        <div className="encode-global-fx-layer" ref={globalFxRef} aria-hidden="true">
          {globalParticles.map(particle => (
            <span
              key={`global-particle-${particle.id}`}
              className={`encode-particle encode-global-particle is-${particle.variant}`}
              style={
                {
                  left: `${particle.x}px`,
                  top: `${particle.y}px`,
                  width: `${particle.size}px`,
                  height: `${particle.size}px`,
                  background: particle.color,
                  '--encode-dx': `${particle.dx}px`,
                  '--encode-dy': `${particle.dy}px`
                } as CSSProperties
              }
            />
          ))}
        </div>
      )}

      {tooltipTarget && (
        <div
          className={`encode-tooltip ${juicyActive ? 'is-juicy' : ''}`}
          style={{ left: `${tooltipLeft}px`, top: `${tooltipTop}px` }}
        >
          <div className="encode-tooltip-country">{tooltipTarget.country}</div>
          <div className="encode-tooltip-category">
            {categoryByKey.get(tooltipTarget.category)?.label ?? tooltipTarget.category}
          </div>
          <div className="encode-tooltip-metric">kg: {formatKg(tooltipDisplay.kg)}</div>
          <div className="encode-tooltip-metric">percent: {formatPercent(tooltipDisplay.percent)}</div>
          <div className="encode-tooltip-metric">
            {encodedLabelByRepresentation(representation)}: {formatPercent(tooltipDisplay.encoded)}
          </div>
        </div>
      )}
    </div>
  )
}