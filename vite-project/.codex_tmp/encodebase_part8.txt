                    handleCategoryColorChange(category.key, event.target.value, event.currentTarget)
                  }
                  aria-label={`${category.label} color`}
                />
              </div>
            ))}
          </div>
        </div>
      </aside>

      {juicyActive && (
        <div className="encode-global-fx-layer" ref={globalFxRef} aria-hidden="true">
          {colorPickerFrameVisible && activeColorCategory && colorPickerFramePosition && (
            <span
              className="encode-color-picker-frame"
              style={
                {
                  left: `${colorPickerFramePosition.x}px`,
                  top: `${colorPickerFramePosition.y}px`,
                  borderColor: colorPickerFramePosition.color
                } as CSSProperties
              }
            />
          )}
          {globalParticles.map(particle => (
            <span
              key={`global-particle-${particle.id}`}
              className={`encode-particle encode-global-particle is-${particle.variant}`}
              style={
                {
                  left: `${particle.x}px`,
                  top: `${particle.y}px`,
                  width: `${particle.size}px`,
                  height: `${particle.size}px`,
                  background: particle.color,
                  '--encode-dx': `${particle.dx}px`,
                  '--encode-dy': `${particle.dy}px`
                } as CSSProperties
              }
            />
          ))}
        </div>
      )}

      {tooltipTarget && (
        <div
          className={`encode-tooltip ${juicyActive ? 'is-juicy' : ''}`}
          style={{ left: `${tooltipLeft}px`, top: `${tooltipTop}px` }}
        >
          <div className="encode-tooltip-country">{tooltipTarget.country}</div>
          <div className="encode-tooltip-category">
            {categoryByKey.get(tooltipTarget.category)?.label ?? tooltipTarget.category}
          </div>
          <div className="encode-tooltip-metric">kg: {formatKg(tooltipDisplay.kg)}</div>
          <div className="encode-tooltip-metric">percent: {formatPercent(tooltipDisplay.percent)}</div>
          <div className="encode-tooltip-metric">
            {encodedLabelByRepresentation(representation)}: {formatPercent(tooltipDisplay.encoded)}
          </div>
        </div>
      )}
    </div>
  )
}